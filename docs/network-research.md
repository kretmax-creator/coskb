# Исследование сети

Дата: 24.02.2026

## Цель

Определить сетевую топологию VM и возможности:
1. Внешнего доступа к Wiki.js (без корпоративного VPN).
2. Исходящего доступа к `api.telegram.org` (для Telegram-бота).

---

## 1. Внутренний IP VM

```bash
ip addr show | grep "inet " | grep -v "127.0.0.1"
```

**Результат:**

```
inet 172.24.120.131/24 brd 172.24.120.255 scope global ens192
inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
inet 172.18.0.1/16 brd 172.18.255.255 scope global br-66fed1842557
```

Основной интерфейс: `ens192`, IP `172.24.120.131/24`.
Docker-сети: `172.17.0.0/16` (docker0), `172.18.0.0/16` (br-66fed1842557 — сеть coskb).

---

## 2. Внешний IP (как видит интернет)

```bash
curl -s ifconfig.me
```

**Результат:**

```
91.241.13.24
```

**Совпадает с внутренним?**
- [ ] Да → VM имеет публичный IP
- [x] Нет → VM за NAT

VM находится за корпоративным NAT: внутренний `172.24.120.131` ≠ внешний `91.241.13.24`.

---

## 3. Доступность порта 8890 извне

### 3.1 Проверка с VM (порт слушается?)

```bash
ss -tlnp | grep 8890
```

**Результат:**

```
LISTEN 0  4096  0.0.0.0:8890  0.0.0.0:*  users:(("docker-proxy",pid=83472,fd=8))
LISTEN 0  4096     [::]:8890     [::]:*  users:(("docker-proxy",pid=83478,fd=8))
```

Порт 8890 слушается на всех интерфейсах (IPv4 + IPv6) через docker-proxy.

### 3.2 Проверка извне корпоративной сети

В браузере с устройства вне корпоративного VPN: `http://91.241.13.24:8890`

**Результат:**
- [ ] Ответ получен → порт доступен извне
- [x] Таймаут → порт закрыт файрволлом / NAT
- [ ] Не удалось проверить (указать причину)

Порт 8890 не доступен извне. Корпоративный файрволл/NAT блокирует входящие соединения.

---

## 4. Доступ VM к api.telegram.org

```bash
curl -s --connect-timeout 5 -o /dev/null -w "%{http_code}" https://api.telegram.org
```

**Результат:**

```
302
```

HTTP 302 (redirect) — соединение с `api.telegram.org` по HTTPS установлено успешно.

- [x] Соединение успешно → Telegram-бот может работать с long polling
- [ ] Таймаут/ошибка → нужен proxy или альтернативный подход

---

## 5. Итоги

| Параметр | Значение |
|----------|----------|
| Внутренний IP | `172.24.120.131` |
| Внешний IP | `91.241.13.24` |
| За NAT? | Да (корпоративный NAT) |
| Порт 8890 доступен извне? | Нет (файрволл/NAT) |
| Доступ к api.telegram.org? | Да (HTTP 302) |

## 6. Решение

### Доступ к Wiki.js извне

- [ ] **Вариант A:** Прямой доступ по IP — невозможен (порт закрыт корпоративным файрволлом)
- [ ] **Вариант B:** Tailscale / ZeroTier (mesh VPN, клиент на устройствах) — возможен, требует установки клиента
- [x] **Вариант C:** Оставить только через корпоративный VPN — текущее решение
- [ ] **Вариант D:** Cloudflare Tunnel / ngrok — возможен, требует дополнительной настройки

Прямой доступ по IP невозможен из-за корпоративного NAT/файрволла.
Для доступа без корпоративного VPN потребуется дополнительное решение (Tailscale, Cloudflare Tunnel и т.п.) — отложено на будущее.
Текущий доступ: через корпоративный VPN → `http://172.24.120.131:8890`.

### Telegram-бот

- [x] Доступ к API подтверждён → можно реализовывать (long polling)
- [ ] Доступ заблокирован → нужен proxy / альтернатива
